<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tools</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" 
        integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" 
        crossorigin="anonymous">
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<script src="assets/jquery-3.3.1.min.js"></script>
	<script src="assets/bootstrap/js/bootstrap.min.js"></script>
	<style>
        body {
            background-color: #f8f8f8;
        }
		a {
			text-decoration: none !important;
		}
		a.remove {
			color: red; 
			float: right;
		}

	</style>
</head>
<body>

<!-- Nav tabs -->
<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#arrayFormatter">Array Formatter</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#jsonToYaml">Json To Yaml</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#writeDocsWithSwagger">Write Docs With Swagger</a>
    </li>
</ul>
  
<!-- Tab panes -->
<div class="tab-content">

    <!-- Array formatter -->
    <div class="tab-pane container pt-4 active" id="arrayFormatter">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="arrayInput">Input</label>
                    <textarea class="form-control" id="arrayInput" rows="20"></textarea>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="arrayOutput">Output</label>
                    <a href="#" onclick="event.preventDefault(); copyArrayFormatterResult();" 
                        class="float-right" style="color: #444;">
                        <span>Copy to clipboard</span>
                        <i class="fa fa-clipboard"></i>
                    </a>
                    <textarea class="form-control" id="arrayOutput" rows="20"></textarea>
                </div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="formatArray()">Format</button>
    </div>

    <!-- Json To Yaml Converter -->
    <div class="tab-pane container pt-4 fade" id="jsonToYaml">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="jsonTextarea">Json</label>
                    <textarea id="jsonTextarea" rows="20" class="form-control"></textarea>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="yamlTextarea">Yaml</label>
                    <textarea id="yamlTextarea" rows="20" class="form-control"></textarea>
                </div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="content_func()">Convert</button>
    </div>

    <!-- Write Docs with Swagger -->
    <div class="tab-pane container pt-4 fade" id="writeDocsWithSwagger">
        <div class="card card-body mb-3">
            <form action="">
                <h4>Main</h4>
                <hr>
                <div class="form-group">
                    <label for="url">URL</label>
                    <input name="url" id="url" class="form-control" placeholder="URL route" required>
                </div>
                <div class="form-group">
                    <label for="method_type">Method type</label>
                    <input name="method_type" id="method_type" class="form-control" placeholder="POST or GET" required>
                </div>
                <div class="form-group">
                    <label for="tags">Tags</label>
                    <input name="tags" id="tags" class="form-control" placeholder="Tags" required>
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <input name="description" id="description" class="form-control" placeholder="Description">
                </div>
                <button type="button" class="btn btn-primary" onclick="saveMainInputs(this)">Save</button>
            </form>
        </div>

        <div class="card card-body mb-3">
            <form action="">
                <h4>Parameters</h4>
                <hr>
                <div class="form-group">
                    <label for="in">In</label>
                    <input type="text" name="in" id="in" class="form-control" placeholder="In" required>
                </div>
                <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text" name="name" id="name" class="form-control" placeholder="Name" required>
                </div>
                <div class="form-group">
                    <label for="description1">Description</label>
                    <input type="text" name="description1" id="description1" class="form-control" placeholder="Description">
                </div>
                <div class="form-group">
                    <label for="type">Type</label>
                    <input type="text" name="type" id="type" class="form-control" placeholder="Type" required>
                </div>
                <div class="form-group">
                    <input type="checkbox" name="required" id="required" required>
                    <label for="required">Required</label>
                </div>
                <button type="button" class="btn btn-primary" onclick="saveParameter(this)">
                    Save
                </button>
            </form>
        </div>

        <div class="card card-body mb-3">
            <form action="">
                <h4>Responses</h4>
                <hr>
                <div class="form-group">
                    <label for="number">Number</label>
                    <input type="text" name="number" class="form-control" placeholder="Response number" required>
                </div>
                <div class="form-group">
                    <label for="description2">Description</label>
                    <input type="text" name="description2" class="form-control" placeholder="Description">
                </div>
                <div class="form-group">
                    <label for="content">Content</label>
                    <textarea name="content" rows="5" class="form-control" placeholder="Json object" required></textarea>
                </div>
                <button type="button" class="btn btn-primary" onclick="saveResponse(this)">Save</button>
            </form>
        </div>

        <div class="card card-body mb-3">
            <button class="btn btn-success" onclick="getResult()">Get result</button>
            <hr>
            <h4 class="mb-3">
                Result
                
            </h4>
            <textarea id="resultBox" rows="15" class="form-control" disabled placeholder="The results will be showen here"></textarea>
        </div>
    </div>
</div>

<script type="module" src="assets/js/tools.js"></script>
<script>

    const copyArrayFormatterResult = () => {
        document.getElementById('arrayOutput').select();
        document.execCommand("copy");
    }

    let main = {};
    let parameters = [];
    let responses = [];

    const saveMainInputs = (btn) => {

        let form = new FormData(btn.parentElement);

        main = {
            url: form.get('url'),
            method_type: form.get('method_type'),
            tags: form.get('tags'),
            description: form.get('description')
        };

        console.log(main);

        let alert = `<div class="alert alert-success fade show alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        Successfully added.
                    </div>`;

        btn.parentElement.insertAdjacentHTML("afterbegin", alert);

        setTimeout(() => {
            document.getElementsByClassName('close')[0].click();
        }, 1500);
    }

	const saveParameter = (btn) => {

        let form = new FormData(btn.parentElement);

        let obj = {
            in: form.get('in'),
            name: form.get('name'),
            description: form.get('description1'),
            type: form.get('type'),
            required: form.get('required') ? true : false
        };

        // Add the param to params array
        parameters.push(obj);

        // Reset the form to add new data param
        btn.parentElement.reset();

        console.log(parameters);

        let alert = `<div class="alert alert-success fade show alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        Successfully added.
                    </div>`;

        btn.parentElement.insertAdjacentHTML("afterbegin", alert);

        setTimeout(() => {
            document.getElementsByClassName('close')[0].click();
        }, 1500);
	}

    const saveResponse = (btn) => {
        let form = new FormData(btn.parentElement);

        let obj = {
            number: form.get('number'),
            description: form.get('description2'),
            content: form.get('content')
        };

        // Add the response to responses array
        responses.push(obj);

        // Reset the form to add new data response
        btn.parentElement.reset();

        console.log(responses);

        let alert = `<div class="alert alert-success fade show alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        Successfully added.
                    </div>`;

        btn.parentElement.insertAdjacentHTML("afterbegin", alert);

        setTimeout(() => {
            document.getElementsByClassName('close')[0].click();
        }, 1500);
    }

    const getResult = () => {
        let str = main.url + ': \n';
        str += getSpaces(1) + main.method_type + ': \n';
        
        str += getSpaces(2) + 'description: ' + main.description + '\n';

        str += getSpaces(2) + 'tags:' + '\n';
        str += getSpaces(3) + '- ' + main.tags + '\n';

        str += getSpaces(2) + 'parameters:' + '\n';
        for (let obj of parameters) {
            str += getSpaces(3) + '- in: ' + obj.in + '\n';
            str += getSpaces(4) + 'name: ' + obj.name + '\n';
            if(obj.description) {
                str += getSpaces(4) + 'description: ' + obj.description + '\n';
            }
            str += getSpaces(4) + 'schema: \n';
            str += getSpaces(5) + 'type: ' + obj.type + '\n';

            if(obj.required) {
                str += getSpaces(4) + 'required: ' + obj.required + '\n';
            }
        }

        str += getSpaces(2) + 'responses:' + '\n';
        for (let obj of responses) {
            str += getSpaces(3) + obj.number + ': \n';

            if(obj.description) {
                str += getSpaces(4) + 'description: ' + obj.description + '\n';
            }

            str += getSpaces(4) + 'content: \n';
            str += getSpaces(5) + 'application/json: \n';
            str += getSpaces(6) + 'schema: \n';
            str += JsonToYamlConverter.convert(JSON.parse(obj.content), 7);
        }
        
        document.getElementById('resultBox').value = str;

        $('html, body').animate({
            scrollTop: $("#resultBox").offset().top
        }, 'slow');
    }

    const getSpaces = (num) => {
        let spaces = '                                        '; // 40 spaces
        return spaces.substr(0, num);
    }

</script>
</body>
</html>